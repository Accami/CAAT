<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>Tutorial 3 - Animable elements</title>

<script type="text/javascript" src="sh/shCore.js"></script>
<script type="text/javascript" src="sh/shBrushJScript.js"></script>
<link href="sh/shCore.css" rel="stylesheet" type="text/css" />
<link href="sh/shThemeDefault.css" rel="stylesheet" type="text/css" />    

<script type="text/javascript" src="../../src/CAAT.js"></script>

<script type="text/javascript" src="../../src/core/class.js"></script>
<script type="text/javascript" src="../../src/core/browserdetect.js"></script>

<script type="text/javascript" src="../../src/model/actor.js"></script>
<script type="text/javascript" src="../../src/model/conpoundimage.js"></script>
<script type="text/javascript" src="../../src/model/imagepreloader.js"></script>
<script type="text/javascript" src="../../src/model/director.js"></script>
<script type="text/javascript" src="../../src/model/mouseevent.js"></script>
<script type="text/javascript" src="../../src/model/scene.js"></script>

<script type="text/javascript" src="../../src/math/affinetransform2D.js"></script>
<script type="text/javascript" src="../../src/math/point.js"></script>
<script type="text/javascript" src="../../src/math/rectangle.js"></script>
<script type="text/javascript" src="../../src/math/bezier.js"></script>

<script type="text/javascript" src="../../src/path/path.js"></script>
<script type="text/javascript" src="../../src/path/pathactor.js"></script>
<script type="text/javascript" src="../../src/path/interpolator.js"></script>
<script type="text/javascript" src="../../src/path/interpolatoractor.js"></script>

<script type="text/javascript" src="../../src/behaviour/behaviour.js"></script>

<script type="text/javascript">
     SyntaxHighlighter.all()
</script>
    
<style>
    div.code {
       font-size: .7em;
    }
</style>

</head>


<body style="color:black; background:#ffffff;">

<div class="section">
    <h1>CAAT.Actor</h1>
    <p>CAAT.Actor is the simplest object instance that will be drawn on screen.</p>
    <p>This object contains default functionality for</p>
    <ol>
        <li>Set position on screen. In fact, as we've already seen on previous chapters, set position on the Director Canvas.</li>
        <li>Set Size</li>
        <li>Set affine transforms (rotation, scale and translation)</li>
        <li>Compose transformations. A container Actor will transform its children before they apply their own transformation.</li>
        <li>Enable clipping.</li>
        <li>The API is developed to allow method chaining when possible.</li>
        <li>etc.</li>
    </ol>
    <p>One important fact about Actors is the coordinate system. An Actor will always report local coordinates
    despite the transformation applied to it. In example, an Actor can be scaled twice widely, and rotated
    45 degrees, and on mouseMove the received event will report local Actor coordinates as if the actor itself weren't transformed.</p>
    <p>An Actor by itself won't display on screen. The correct hierarchy to be defined is as follows:
    <ul>
        <li>Create a Director</li>
        <li>Create a Scene</li>
        <li>Add at least one Scene to the Director</li>
        <li>Add Actor instances to the Scene</li>
    </ul>
</div>

<div class="section">
    <h1>Mouse Events</h1>
        <p>In normal conditions an Actor has mouse events enabled by default. The mouse control methods are the following:</p>
        <ul>
		    <li><strong>mouseEnter</strong><br>Triggered whenever the mouse enters the rectangular area of an Actor. The Actor can
            be transformed by rotations and scales. That means that CAAT will perform perfect pixel collision detection
            so the mouse arrow must be inside the contour of the Actor despite the transformation applied to id.</li>
		    <li><strong>mouseExit</strong><br>Exactly like in mouseEnter, but when leaving the Actors contour.</li>
		    <li><strong>mouseMove</strong><br>Triggered whenever the mouse arrow traverses inside the Actor's contour.</li>
		    <li><strong>mouseDown</strong><br>Triggered whenever we press the mouse button inside the Actor's contour.</li>
		    <li><strong>mouseUp</strong><br>Same as mouseDown but when releasing the mouse button.</li>
            <li><strong>mouseClick</strong><br>Triggered whenever a click has been generated on the Actor. That means
            that previously a mouseDown and then a mouseDown have been triggered on the Actor.</li>
            <li><strong>mouseDblClick</strong><br>Same as mouseClick but double click.</li>
		    <li><strong>mouseDrag</strong><br>Triggered after we perform an equivalent to mouseMove after having done mouseDown.
            After dragging, when releasing the mouse button, only mouseUp will be triggered avoiding to trigger
            mouseClick event.</li>
        </ul>
        <p>All these methods receive a unique parameter of type CAAT.MouseEvent. It contains the following information:</p>
        <ul>
            <li><b>screenPoint</b><br>The 2D point of the screen coordinate that originated the mouse event.</li>
            <li><b>point</b><br>The 2D point of local Actor coordinates. Remember that local coordinates are from (0,0) to actor's
                (width,height). These 2D point is derived from the screenPoint.</li>
            <li><b>modifiers</b><br>Modifiers will tell you whether some special keys where pressed during the mouse input. The
            CAAT.MouseEvent class has some methods to check for these special keys.</li>
            <li><b>time</b><br>The Scene time (more on this later) at which the event was produced.</li>
            <li><b>source</b><br>The actor the event was produced at.</li>
        </ul>
</div>

<div class="section">
    <p>In this example, you can see some rectangle-shaped actors. The canvas show local coordinates on
    mouseOver for different actors and the screen coordinate from which the Actor local coordinate was
    derived from. It also shows how perfect pixel collision detection works.</p>
    <p>Since a container can contain any number of Actors and hence any number of other containers,
    you can nest as much levels as desired and CAAT will solve local/screen and parent coordinates
    as well.</p>
    <div class="code">
        <pre class="brush: js; auto-links: false; toolbar: false;">
        <script>
            var director_1 = new CAAT.Director().initialize(
                    600,120,
                    document.getElementById('_c1'));
            var scene_1=     new CAAT.Scene().create();

            director_1.addScene(scene_1);

            // create six actors for this scene.
            for(var i=0; i<6; i++ ) {

                // rectangle shaped actors of 80x80 pixels.
                var s = 80;

                // containers can contain other actors or containers.
                var _c1_container = new CAAT.ActorContainer().
                        setBounds(i*100+10, 20, s, s).
                        create().
                        setRotation( Math.PI*2*Math.random() ).
                        setFillStyle('#ff3fff');

                _c1_container.name = 'rectangle'+i;
                // set container paint routine to draw an arrow
                _c1_container.paint= function(director, time) {

                    var crx= director.ctx;

                    // fill actor
                    crx.fillStyle= this.fillStyle;
                    crx.fillRect(0,0,this.width,this.height );

                    // outline it.
                    crx.strokeStyle= 'black';
                    crx.strokeRect(0,0,this.width,this.height );

                    // draw a white arrow. just to point where position 0,0 is.
                    crx.strokeStyle='white';
                    crx.beginPath();
                    crx.moveTo(5,10);
                    crx.lineTo(20,10);
                    crx.lineTo(15,5);

                    crx.moveTo(20,10);
                    crx.lineTo(15,15);

                    crx.lineWidth=2;
                    crx.lineJoin='round';
                    crx.lineCap='round';

                    crx.stroke();
                };

                // add actor to scene.
                scene_1.addChild(_c1_container);

                var mouseMoveHandler= function(mouseEvent) {
                    // get the scene Actor the event was generated for.
                    var actor= mouseEvent.source;

                    // show some event info:
                    document.getElementById('_c1_coords').innerHTML=
                            "<b>Actor:</b>"+ actor.name+" "+
                            "<b>Local Coord:</b> ("+
                                // with all this stuff i'm just stripping
                                // off any decimal beyond .99
                                ((mouseEvent.point.x*100)>>0)/100+","+
                                ((mouseEvent.point.y*100)>>0)/100+") "+
                            "<b>Screen Coord:</b> ("+
                                mouseEvent.screenPoint.x+","+
                                mouseEvent.screenPoint.y+") "+
                            "<b>Parent Coord:</b> ("+
                                actor.x+","+actor.y+")";
                };

                // create a container.
                var _c1_container_child= new CAAT.ActorContainer().
                        create().
                        setBounds(s/2,s/2,s/4,s/4).
                        setRotation( Math.PI*2*Math.random() ).
                        setFillStyle('#00ff00');

                // set a custom paint function for children inside containers.
                _c1_container_child.paint= function(director,time) {
                    // call default container paint method.
                    CAAT.ActorContainer.superclass.paint.call(this,director,time);
                    var ctx= director.ctx;

                    // fill a white circle of 10x10 pixels at position 2,2
                    // just to show where 0,0 is positioned on screen.
                    ctx.fillStyle='white';
                    ctx.beginPath();
                    ctx.arc(7,7,5,0,2*Math.PI,false);
                    ctx.fill();
                }


                // add this container as a child of the previous created container.
                _c1_container.addChild(_c1_container_child);

                // set new mouseMove handlers.
                _c1_container.mouseMove= mouseMoveHandler;
                _c1_container_child.mouseMove =mouseMoveHandler;

            }

            // set animation to 10fps.
            director_1.loop(10);
        </script>
        </pre>
    </div>

    <div class="sample">
        <div><canvas id="_c1"></canvas></div>
        <div><small><span id="_c1_coords"></span></small></div>
        <script>
            var director_1 = new CAAT.Director().initialize(
                    600,120,
                    document.getElementById('_c1'));
            var scene_1=     new CAAT.Scene().create();

            director_1.addScene(scene_1);

            // create six actors for this scene.
            for(var i=0; i<6; i++ ) {

                // rectangle shaped actors of 80x80 pixels.
                var s = 80;

                // containers can contain other actors or containers.
                var _c1_container = new CAAT.ActorContainer().
                        setBounds(i*100+10, 20, s, s).
                        create().
                        setRotation( Math.PI*2*Math.random() ).
                        setFillStyle('#ff3fff');

                _c1_container.name = 'rectangle'+i;
                // set container paint routine to draw an arrow
                _c1_container.paint= function(director, time) {

                    var crx= director.ctx;

                    // fill actor
                    crx.fillStyle= this.fillStyle;
                    crx.fillRect(0,0,this.width,this.height );

                    // outline it.
                    crx.strokeStyle= 'black';
                    crx.strokeRect(0,0,this.width,this.height );

                    // draw a white arrow. just to point where position 0,0 is.
                    crx.strokeStyle='white';
                    crx.beginPath();
                    crx.moveTo(5,10);
                    crx.lineTo(20,10);
                    crx.lineTo(15,5);

                    crx.moveTo(20,10);
                    crx.lineTo(15,15);

                    crx.lineWidth=2;
                    crx.lineJoin='round';
                    crx.lineCap='round';

                    crx.stroke();
                };

                // add actor to scene.
                scene_1.addChild(_c1_container);

                var mouseMoveHandler= function(mouseEvent) {
                    // get the scene Actor the event was generated for.
                    var actor= mouseEvent.source;

                    // show some event info:
                    document.getElementById('_c1_coords').innerHTML=
                            "<b>Actor:</b>"+ actor.name+" "+
                            "<b>Local Coord:</b> ("+
                                // with all this stuff i'm just stripping
                                // off any decimal beyond .99
                                ((mouseEvent.point.x*100)>>0)/100+","+
                                ((mouseEvent.point.y*100)>>0)/100+") "+
                            "<b>Screen Coord:</b> ("+
                                mouseEvent.screenPoint.x+","+
                                mouseEvent.screenPoint.y+") "+
                            "<b>Parent Coord:</b> ("+
                                actor.x+","+actor.y+")";
                };

                // create a container.
                var _c1_container_child= new CAAT.ActorContainer().
                        create().
                        setBounds(s/2,s/2,s/4,s/4).
                        setRotation( Math.PI*2*Math.random() ).
                        setFillStyle('#00ff00');

                // set a custom paint function for children inside containers.
                _c1_container_child.paint= function(director,time) {
                    // call default container paint method.
                    CAAT.ActorContainer.superclass.paint.call(this,director,time);
                    var ctx= director.ctx;

                    // fill a white circle of 10x10 pixels at position 2,2
                    // just to show where 0,0 is positioned on screen.
                    ctx.fillStyle='white';
                    ctx.beginPath();
                    ctx.arc(7,7,5,0,2*Math.PI,false);
                    ctx.fill();
                }


                // add this container as a child of the previous created container.
                _c1_container.addChild(_c1_container_child);

                // set new mouseMove handlers.
                _c1_container.mouseMove= mouseMoveHandler;
                _c1_container_child.mouseMove =mouseMoveHandler;
                
            }

            // set animation to 10fps.
            director_1.loop(10);
        </script>
    </div>
</div>


<div class="section">
    <p>Let's start by understanding the elements of the hierarchy and their API from top down, that's it, from the
    Director to simple Actors.</p>
</div>

<div class="section">
    <h1>CAAT.Director</h1>
    <p>The director is the root in the hierarchy of CAAT components. There can be more than one director on the same
    page though. This element will be responsible for many key features including:</p>
    <ul>
        <li>Manage the Scenes.</li>
        <li>Ellegantly switch between two given scenes.</li>
        <li>Route input events to the properly Actor.</li>
        <li>Manage the main timeline.</li>
        <li>Stablish custom timelines for each Scene.</li>
        <li>Keep reference of the associated canvas.</li>
        <li>Expose the canvas' rendering context as an internal attribute.</li>
        <li>Keep track of resources such as images and sounds.</li>
    </ul>
    <p>Besides that responsibilities, you have the opportunity of setting the desired animation quality in the form of frames
    per second. This parameter is to set the desired smoothness of the animation though it will automatically balance to fit
    your systems current capabilities.</p>
    <p>The lifecycle of the director will be as follows</p>
    <ol>
        <li>Create the director by specifying at least its dimension.</li>
        <li>Add at least one scene to the director.</li>
        <li>Call the loop method to start the animation.</li>
    </ol>
    <p>Once this process is done, the director starts animation, and won't stop until the the document that contains the actors
    changes.</p>
    <div class="API">
        <h2>API</h2>
        <p>The exposed API methods of the director are:</p>
        <div class="APIENTRY">
            <h3>initialize(width,height,canvas)</h3>
            <p>This method performs Director initialization. Must be called once. If the canvas parameter is not set, it will create
            a Canvas itself, and the developer must explicitly add the canvas to the desired DOM position. This method will also set
            the Canvas dimension to the specified values by width and height parameters.</p>
        </div>
        <div class="APIENTRY">
            <h3>addScene( scene )</h3>
            <p>Add a new Scene to Director's Scene list. By adding a Scene to the Director does not mean it will be immediately visible,
            you should explictly call either <code>easeIn, easeInOut, easeInOutRandom, setScene or any of the scene switching methods</code>.</p>
        </div>
        <div class="APIENTRY">
            <h3>getNumScenes()</h3>
            <p>Gets the number of scenes contained in the Director.</p>
        </div>
        <div class="APIENTRY">
            <h3>getCurrentSceneIndex()</h3>
            <p>Gets the index of the current scene in the Director's scene list.</p>
        </div>
        <div class="APIENTRY">
            <h3>getBrowserName()</h3>
            <p>Gets the running browser name.</p>
        </div>
        <div class="APIENTRY">
            <h3>getBrowserVersion()</h3>
            <p>Gets the running browser version.</p>
        </div>
        <div class="APIENTRY">
            <h3>getOSName()</h3>
            <p>Gets the operating system name.</p>
        </div>
        <div class="APIENTRY">
            <h3>getImage(resource_name)</h3>
            <p>Gets the resource with the specified resource name. The Director hold a parameter called imagesCache where you can store a JSON of
            the form <code>[ { id: imageId, image: imageObject } ]</code>. This structure will be used as a resources cache. There's a CAAT.ImagePreloader
            class to preload resources and generate this structure on loading finalization.</p>
        </div>
        <div class="APIENTRY">
            <h3>emptyScenes</h3>
            <p>Removes Director scenes.</p>
        </div>
        <div class="APIENTRY">
            <h3>loop function(fps)</h3>
            <p>Starts the director animation. If no scene is explicitly selected, The current Scene will be the first scene added to the Director.
            The fps parameter will set the animation quality. Higher values, means CAAT will try to render more frames in the same second (at the
            expense of cpu power at least until hardware accelerated canvas rendering context are available). A value of 60 is a high frame rate and
            should not be exceeded.</p>
        </div>
        <div class="APIENTRY">
            <h3>function setScene( sceneIndex )</h3>
            <p>Changes (or sets) the current Director scene to the index specified as parameter. There will be no transition on scene change.</p>
        </div>
        <div class="APIENTRY">
            <h3>function switchToPrevScene(time, alpha, transition), function switchToNextScene(time, alpha, transition)</h3>
            <p>These methods will switch from the current scene to the previous or the next one respectively. The supplied parameters are:</p>
            <ul>
                <li>time: how much time to take for the switching process. Expressed in milliseconds.</li>
                <li>alpha: wheter alpha transparency fading should be applied to entering/exiting scenes.</li>
                <li>transition: the type of the transition to perform for the entering and exiting scenes.</li>
            </ul>
        </div>


    </div>
</div>

<div class="section">
    <h1>CAAT.Scene</h1>
</div>

<div class="section">
    <h1>CAAT.Actor</h1>
</div>

<div class="section">
    <h1>CAAT.ActorContainer</h1>
</div>

<div class="section">
    <h1>CAAT.SpriteActor</h1>
</div>

<div class="section">
    <h1>CAAT.TextActor</h1>
</div>

<div class="section">
    <h1>CAAT.ShapeActor</h1>
</div>

<div class="section">
    <h1>CAAT.InterpolatorActor</h1>
</div>

<div class="section">
    <h1>CAAT.PathActor</h1>
</div>

<div class="section">
    <h1>Defining custom actors</h1>
</div>

</body>
</html>